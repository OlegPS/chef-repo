#!/bin/bash

if [ "$1" == "config" ]; then
  echo "graph_title Archlinux system maintenance"
  echo "graph_vlabel #"
  echo "graph_category system"

  echo "failed_services.label Failed services"
  echo "failed_services.critical :0"
  echo "failed_services.info Check if any systemd services have entered in a failed state"

  echo "journal_errors.label Journal errors"
  echo "journal_errors.warning :0"
  echo "journal_errors.info Look for high priority errors in the systemd journal"

  echo "installed_packages.label Installed packages"
  echo "installed_packages.warning :400"
  echo "installed_packages.info Installed packages count"
  exit
fi

echo failed_services.value `systemctl --failed | awk '/loaded units listed/{print $1}'`
echo journal_errors.value $(($(journalctl -p 0..3 -b --since="`date +'%Y-%m-%d %H:%M:%S' -d '5 min ago'`" | wc -l)-1))
echo installed_packages.value `pacman -Qq | wc -l`
